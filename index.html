<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Element Modeler - Ver.1.0.4</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="style.css?v=20260210-1">
</head>
<body>
  <!-- Left Toolbar -->
  <aside id="toolbar">
    <div id="toolbar-quick" class="toolbar-sticky-top">
      <h2 data-i18n="tools">ツール</h2>
      <button id="btn-settings">&#9881; <span data-i18n="settings">設定</span></button>
      <span class="layer-label" data-i18n="activeLayer">レイヤー</span>
      <div class="layer-controls">
        <select id="sel-active-layer"></select>
        <button id="btn-layer-manage" class="layer-manage-btn" title="Layer Management">&#9881;</button>
      </div>
      <span class="layer-label" data-i18n="toolLabel">要素</span>
      <div class="layer-controls">
        <select id="sel-tool">
          <option value="select" data-i18n="selectTool">選択</option>
          <option value="member" data-i18n="member">線材</option>
          <option value="surface" data-i18n="surface">面材</option>
          <option value="load" data-i18n="load">荷重</option>
          <option value="support" data-i18n="support">支点</option>
        </select>
      </div>
      <hr>
    </div>
    <div id="tool-opts-member" class="tool-opts">
      <label class="grid-label">
        <span data-i18n="draftMemberType">線材種別</span>
        <select id="sel-member-type">
          <option value="beam" data-i18n="beam">梁</option>
          <option value="column" data-i18n="column">柱</option>
          <option value="hbrace" data-i18n="hbrace">水平ブレース</option>
          <option value="vbrace" data-i18n="vbrace">垂直ブレース</option>
        </select>
      </label>
    </div>
    <div id="tool-opts-surface" class="tool-opts">
      <label class="grid-label">
        <span data-i18n="draftSurfaceType">面材種別</span>
        <select id="sel-surface-type">
          <option value="floor" data-i18n="floor">床</option>
          <option value="exteriorWall" data-i18n="exteriorWall">外壁</option>
          <option value="wall" data-i18n="wall">壁</option>
        </select>
      </label>
      <label id="label-surface-mode" class="grid-label">
        <span data-i18n="surfaceMode">配置方法</span>
        <select id="sel-surface-mode">
          <option value="rect" data-i18n="rectMode">矩形</option>
          <option value="polyline" data-i18n="polylineMode">ポリライン</option>
        </select>
      </label>
      <label id="label-load-direction" class="grid-label">
        <span data-i18n="loadDirection">荷重方向</span>
        <select id="sel-load-direction">
          <option value="x">X</option>
          <option value="y">Y</option>
          <option value="twoWay" data-i18n="twoWay">2方向</option>
        </select>
      </label>
      <label id="label-top-layer" class="grid-label">
        <span data-i18n="topLayer">上端レイヤー</span>
        <select id="sel-top-layer"></select>
      </label>
    </div>
    <div id="tool-opts-load" class="tool-opts">
      <label class="grid-label">
        <span data-i18n="draftLoadType">荷重種別</span>
        <select id="sel-load-type">
          <option value="areaLoad" data-i18n="areaLoad">面荷重</option>
          <option value="lineLoad" data-i18n="lineLoad">線荷重</option>
          <option value="pointLoad" data-i18n="pointLoad">点荷重</option>
        </select>
      </label>
    </div>
    <hr>
    <label class="toggle-label">
      <input type="checkbox" id="chk-snap" checked>
      <span data-i18n="snap">スナップ</span>
    </label>
    <label class="toggle-label">
      <input type="checkbox" id="chk-show-supports" checked>
      <span data-i18n="showSupports">支点表示</span>
    </label>
    <label class="toggle-label">
      <input type="checkbox" id="chk-wide-pick">
      <span data-i18n="widePick">広域選択</span>
    </label>
    <label class="grid-label">
      <span data-i18n="grid">グリッド</span>
      <select id="sel-grid">
        <option value="500">500 mm</option>
        <option value="1000" selected>1000 mm</option>
        <option value="2000">2000 mm</option>
      </select>
    </label>
    <hr>
    <button id="btn-export" title="Save CAD data">&#128190; <span data-i18n="export">CAD保存</span></button>
    <button id="btn-import-trigger" title="Load CAD data">&#128194; <span data-i18n="import">CAD読込</span></button>
    <input type="file" id="file-import" accept=".json" hidden>
  </aside>

  <!-- Main Area -->
  <main id="main-area">
    <!-- View Tabs -->
    <nav id="view-tabs">
      <button id="tab-2d" class="tab-btn active" data-i18n="tab2d">2D CAD</button>
      <button id="tab-3d" class="tab-btn" data-i18n="tab3d">3D 表示</button>
    </nav>

    <!-- Canvas Container -->
    <div id="canvas-container">
      <canvas id="canvas-2d"></canvas>
      <div id="viewer-3d" hidden></div>
    </div>

    <!-- Status Bar -->
    <footer id="status-bar">
      <span id="status-coords">X: 0  Y: 0</span>
      <span id="status-snap" data-i18n="snapOn">スナップ: ON</span>
      <span id="status-zoom">Zoom: 100%</span>
      <span id="status-tool" data-i18n="toolMember">ツール: 線材</span>
      <span id="status-version">Ver.1.0.4</span>
    </footer>
  </main>

  <!-- Right Property Panel -->
  <aside id="property-panel">
    <h2 data-i18n="properties">プロパティ</h2>
    <div id="prop-content">
      <p class="prop-placeholder" data-i18n="noSelection">未選択</p>
    </div>
  </aside>

  <!-- Help Modal -->
  <div id="help-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-i18n="helpTitle">簡易マニュアル</h2>
        <button id="btn-help-close" class="modal-close" data-i18n="helpClose">閉じる</button>
      </div>
      <div id="help-body" class="modal-body"></div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal-content modal-settings">
      <div class="modal-header">
        <h2 data-i18n="settingsTitle">設定</h2>
        <button id="btn-settings-close" class="modal-close" data-i18n="helpClose">閉じる</button>
      </div>
      <div class="modal-body">
        <div class="settings-group">
          <label data-i18n="themeLabel">テーマ</label>
          <select id="settings-theme">
            <option value="dark" data-i18n="themeDark">ダーク</option>
            <option value="light" data-i18n="themeLight">ライト</option>
          </select>
        </div>
        <div class="settings-group">
          <label data-i18n="langLabel">言語</label>
          <select id="settings-lang">
            <option value="ja">日本語</option>
            <option value="en">English</option>
          </select>
        </div>
        <hr>
        <button id="btn-open-user-def" class="settings-help-btn">&#9881; <span data-i18n="userDefManage">ユーザー定義</span></button>
        <div style="height:8px;"></div>
        <button id="btn-open-help" class="settings-help-btn">&#10067; <span data-i18n="help">ヘルプ</span></button>
      </div>
    </div>
  </div>

  <!-- User Definition Modal -->
  <div id="user-def-modal" class="modal-overlay">
    <div class="modal-content modal-settings">
      <div class="modal-header">
        <h2 data-i18n="userDefTitle">ユーザー定義</h2>
        <button id="btn-user-def-close" class="modal-close" data-i18n="helpClose">閉じる</button>
      </div>
      <div class="modal-body">
        <div class="settings-group">
          <label data-i18n="userDefKind">定義種別</label>
          <select id="user-def-kind">
            <option value="section" data-i18n="userDefSection">断面定義</option>
            <option value="spring" data-i18n="userDefSpring">バネ定義</option>
          </select>
        </div>

        <div id="user-def-section-group">
          <div class="settings-group">
            <label data-i18n="userDefTarget">対象</label>
            <select id="user-def-target">
              <option value="member" data-i18n="userDefTargetMember">線材</option>
              <option value="surface" data-i18n="userDefTargetSurface">面材</option>
            </select>
          </div>
          <div class="settings-group">
            <label data-i18n="userDefType">種別</label>
            <select id="user-def-type"></select>
          </div>
          <div class="settings-group">
            <label data-i18n="userDefName">名称</label>
            <input id="user-def-name" type="text" placeholder="U1">
          </div>
          <div class="settings-group">
            <label data-i18n="userDefColor">色</label>
            <input id="user-def-color" type="color" value="#666666">
          </div>
          <div id="user-def-size-group" class="prop-row">
            <div class="settings-group" style="flex:1;">
              <label data-i18n="userDefWidthB">幅 b (mm)</label>
              <input id="user-def-b" type="number" min="1" step="1" value="100">
            </div>
            <div class="settings-group" style="flex:1;">
              <label data-i18n="userDefHeightH">高さ h (mm)</label>
              <input id="user-def-h" type="number" min="1" step="1" value="100">
            </div>
          </div>
          <div class="settings-group">
            <label data-i18n="userDefMemo">メモ</label>
            <input id="user-def-section-memo" type="text" placeholder="">
          </div>
        </div>

        <div id="user-def-spring-group" style="display:none;">
          <div class="settings-group">
            <label data-i18n="userDefName">名称</label>
            <input id="user-def-symbol" type="text" placeholder="SP1">
          </div>
          <div class="settings-group">
            <label data-i18n="userDefMemo">メモ</label>
            <input id="user-def-memo" type="text" placeholder="">
          </div>
        </div>

        <p id="user-def-form-error" class="form-error" hidden></p>

        <button id="btn-user-def-list" class="settings-help-btn">&#128065; <span data-i18n="userDefListOpen">同グループ一覧</span></button>
        <div style="height:8px;"></div>
        <button id="btn-user-def-add" class="settings-help-btn">&#10133; <span data-i18n="userDefAdd">追加</span></button>
        <hr>
        <button id="btn-user-def-export" class="settings-help-btn">&#128190; <span data-i18n="userDefExport">エクスポート</span></button>
        <div style="height:8px;"></div>
        <button id="btn-user-def-import-trigger" class="settings-help-btn">&#128194; <span data-i18n="userDefImport">インポート</span></button>
        <input type="file" id="file-user-def-import" accept=".json" hidden>
      </div>
    </div>
  </div>

  <!-- User Definition List Modal -->
  <div id="user-def-list-modal" class="modal-overlay">
    <div class="modal-content modal-user-def-list">
      <div class="modal-header">
        <h2 data-i18n="userDefListTitle">同グループ定義一覧</h2>
        <button id="btn-user-def-list-close" class="modal-close" data-i18n="helpClose">閉じる</button>
      </div>
      <div id="user-def-list-body" class="modal-body"></div>
    </div>
  </div>

  <!-- Layer Management Modal -->
  <div id="layer-modal" class="modal-overlay">
    <div class="modal-content modal-layer">
      <div class="modal-header">
        <h2 data-i18n="layerManage">レイヤー管理</h2>
        <button id="btn-layer-close" class="modal-close" data-i18n="helpClose">閉じる</button>
      </div>
      <div class="modal-body">
        <div id="layer-list"></div>
        <p id="layer-form-error" class="form-error" hidden></p>
        <button id="btn-layer-add" class="settings-help-btn">+ <span data-i18n="layerAdd">追加</span></button>
      </div>
    </div>
  </div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
    }
  }
  </script>
  <script type="module" src="js/app.js?v=20260210-1"></script>
</body>
</html>
